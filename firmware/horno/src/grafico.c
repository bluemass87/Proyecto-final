/*
 * grafico.c
 *
 *  Created on: 22 de oct. de 2016
 *      Author: m4v
 */

#if defined(NO_BOARD_LIB)
#include "chip.h"
#else
#include "board.h"
#endif

#include "320240.h"
#include "grafico.h"

#include <stdlib.h>

/* estructura para guardar bloques de 32x42 píxeles */
typedef struct {
	uint32_t linea[42];
} BLOQUE42_T;

/* estructura para guardar bloques de 12x12 píxeles */
//typedef struct {
//	uint8_t linea[12];
//} BLOQUE12_T;
//
//const BLOQUE12_T Flechita[] = {
//		{{ /* */
//				0xF0,0xF0,0xF0,0xF0,0xF0,0x00,0x80,0xC0,0xE0,
//				0xF0,0xF8,0xFD
//		}}
//	};

uint8_t flecha[12]= {0xF0,0xF0,0xF0,0xF0,0xF0,0x00,0x80,0xC0,0xE0,0xF0,0xF8,0xFD};

void Horno_grafico_flecha(uint32_t x, uint32_t y) {
	for (uint32_t i=0; i < 12; i++) {
		Set_graphic_position(x/8, y+i);
			Command_Write(MEM_WRITE);
			Parameter_Write((~flecha[i]));
	}
}

void Horno_grafico_CLR_flecha(uint32_t x, uint32_t y) {
	for (uint32_t i=0; i < 12; i++) {
		Set_graphic_position(x/8, y+i);
			Command_Write(MEM_WRITE);
			Parameter_Write(0X00);
	}
}



const BLOQUE42_T HORNO_DIGITO[] = {
	{{ /* número 0*/
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00003E00,
		 0x0000FF80, 0x0003FFE0, 0x0003E3E0, 0x000780F0, 0x000780F0, 0x000F0078, 0x000F0078,
		 0x000F0078, 0x001E003C, 0x001E003C, 0x001E003C, 0x001E003C, 0x001E003C, 0x001E003C,
		 0x001E003C, 0x001E003C, 0x001E003C, 0x001E003C, 0x001E003C, 0x000F0078, 0x000F0078,
		 0x000F0078, 0x000780F0, 0x000780F0, 0x0003E3E0, 0x0003FFE0, 0x0000FF80, 0x00003E00,
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000

	}},
	{{ /* número 1*/
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
		 0x0000FE00, 0x000FFE00, 0x000FFE00, 0x000F1E00, 0x00001E00, 0x00001E00, 0x00001E00,
		 0x00001E00, 0x00001E00, 0x00001E00, 0x00001E00, 0x00001E00, 0x00001E00, 0x00001E00,
		 0x00001E00, 0x00001E00, 0x00001E00, 0x00001E00, 0x00001E00, 0x00001E00, 0x00001E00,
		 0x00001E00, 0x00001E00, 0x00001E00, 0x00001E00, 0x0007FFF8, 0x0007FFF8, 0x0007FFF8,
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000

	}},
	{{ /* número 2*/
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0001FC00,
		 0x000FFF00, 0x001FFFC0, 0x001F07E0, 0x001803E0, 0x001001F0, 0x000000F0, 0x000000F0,
		 0x000000F0, 0x000000F0, 0x000000F0, 0x000001E0, 0x000001E0, 0x000003C0, 0x000007C0,
		 0x00000F80, 0x00001F00, 0x00001F00, 0x00003E00, 0x00007C00, 0x0000F800, 0x0001F000,
		 0x0003E000, 0x0007C000, 0x000FC000, 0x001F8000, 0x001FFFF0, 0x001FFFF0, 0x001FFFF0,
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000

	}},
	{{ /* número 3*/
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0003FE00,
		 0x000FFF80, 0x000FFFC0, 0x000C07E0, 0x000001E0, 0x000001F0, 0x000000F0, 0x000000F0,
		 0x000000F0, 0x000000F0, 0x000000E0, 0x000001E0, 0x000003C0, 0x0000FF80, 0x0000FF00,
		 0x0000FFC0, 0x000003E0, 0x000000F0, 0x000000F8, 0x00000078, 0x00000078, 0x00000078,
		 0x00000078, 0x000000F8, 0x001001F0, 0x001C03F0, 0x001FFFE0, 0x001FFF80, 0x0007FE00,
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000

	}},
	{{ /* número 4*/
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
		 0x000007C0, 0x00000FC0, 0x00000FC0, 0x00001FC0, 0x00003FC0, 0x00003BC0, 0x000073C0,
		 0x0000F3C0, 0x0000E3C0, 0x0001C3C0, 0x0001C3C0, 0x000383C0, 0x000703C0, 0x000703C0,
		 0x000E03C0, 0x001E03C0, 0x001C03C0, 0x003803C0, 0x003FFFFC, 0x003FFFFC, 0x003FFFFC,
		 0x000003C0, 0x000003C0, 0x000003C0, 0x000003C0, 0x000003C0, 0x000003C0, 0x000003C0,
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000

	}},
	{{ /* número 5*/
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
		 0x000FFFE0, 0x000FFFE0, 0x000FFFE0, 0x000F0000, 0x000F0000, 0x000F0000, 0x000F0000,
		 0x000F0000, 0x000F0000, 0x000F0000, 0x000FFE00, 0x000FFF80, 0x000FFFC0, 0x000C07E0,
		 0x000001F0, 0x000000F0, 0x000000F8, 0x00000078, 0x00000078, 0x00000078, 0x00000078,
		 0x000000F8, 0x000000F0, 0x001001F0, 0x001C07E0, 0x001FFFC0, 0x001FFF80, 0x0007FC00,
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000

	}},
	{{ /* número 6*/
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00001FC0,
		 0x00007FF0, 0x0001FFF0, 0x0003F030, 0x0003C000, 0x00078000, 0x00078000, 0x000F0000,
		 0x000F0000, 0x000F0000, 0x001E1F00, 0x001E7FC0, 0x001EFFF0, 0x001FC1F0, 0x001F80F8,
		 0x001F0078, 0x001E003C, 0x001E003C, 0x001E003C, 0x001E003C, 0x000E003C, 0x000E003C,
		 0x000F007C, 0x00070078, 0x000780F8, 0x0003C1F0, 0x0001FFE0, 0x0000FFC0, 0x00003F00,
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000

	}},
	{{ /* número 7*/
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
		 0x001FFFF8, 0x001FFFF8, 0x001FFFF8, 0x000000F0, 0x000000F0, 0x000001F0, 0x000001E0,
		 0x000001E0, 0x000003C0, 0x000003C0, 0x000007C0, 0x00000780, 0x00000780, 0x00000F80,
		 0x00000F00, 0x00000F00, 0x00001F00, 0x00001E00, 0x00001E00, 0x00003C00, 0x00003C00,
		 0x00007C00, 0x00007800, 0x00007800, 0x0000F800, 0x0000F000, 0x0000F000, 0x0001E000,
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000

	}},
	{{ /* número 8*/
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00007F00,
		 0x0001FFC0, 0x0003FFE0, 0x0007C1F0, 0x000780F0, 0x000F0078, 0x000F0078, 0x000F0078,
		 0x000F0078, 0x000F0078, 0x00070070, 0x000780F0, 0x0003C1E0, 0x0001FFC0, 0x0000FF80,
		 0x0003FFE0, 0x0007C1F0, 0x000F0078, 0x000F0078, 0x001E003C, 0x001E003C, 0x001E003C,
		 0x001E003C, 0x001F007C, 0x000F0078, 0x000FC1F8, 0x0007FFF0, 0x0003FFE0, 0x00007F00,
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000

	}},
	{{ /* número 9*/
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00007E00,
		 0x0001FF80, 0x0003FFC0, 0x0007C1E0, 0x000F80F0, 0x000F0070, 0x001F0078, 0x001E0038,
		 0x001E0038, 0x001E003C, 0x001E003C, 0x001E003C, 0x001E003C, 0x000F007C, 0x000F80FC,
		 0x0007C1FC, 0x0007FFBC, 0x0001FF3C, 0x00007C3C, 0x00000078, 0x00000078, 0x00000078,
		 0x000000F0, 0x000000F0, 0x000001E0, 0x000607E0, 0x0007FFC0, 0x0007FF00, 0x0001FC00,
		 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000
	}}
};



/*
 * @brief grafica un número de 24x42 pixeles
 * @param x: posición X en pixels
 * @param y: posición Y en pixels
 * @param num: dígito de 0 a 9
 */
void Horno_grafico_digito(uint32_t x, uint32_t y, uint32_t num) {
	BLOQUE42_T bloque = HORNO_DIGITO[num];
	for (uint32_t i=0; i < 42; i++) {
		Set_graphic_position(x/8, y+i);
		uint32_t linea = bloque.linea[i];
		for (uint32_t p=3; p>0;p--) { // p cuenta para atrás para no deformar el gráfico
			/* separo los 32 bits en bloques de 8 */
			uint8_t byte = (linea & (0xFF<<((p-1)*8)))>>((p-1)*8);
			Command_Write(MEM_WRITE);
			Parameter_Write(byte);
		}
	}
}

void Horno_grafico_CLR_digito(uint32_t x, uint32_t y) {
	for (uint32_t i=0; i < 42; i++) {
		Set_graphic_position(x/8, y+i);
		for (uint32_t p=3; p>0;p--) { // p cuenta para atrás para no deformar el gráfico
			uint8_t byte = 0x00;
			Command_Write(MEM_WRITE);
			Parameter_Write(byte);
		}
	}
}

void Horno_grafico_entero(uint32_t y, uint32_t dato){
   	uint32_t pos[4]={245, 220, 195, 170};
	uint32_t numero;
	numero=dato;

	// Caso que sea dato>9999 ya muestro 9999
	if (numero>=9999){
		// Poner er 9999
	   	for(int i=0;i<4;i++){
	   		Horno_grafico_digito(pos[i], y, 9);
	   	}
	}
	else if(numero==0){
   		Horno_grafico_digito(pos[0], y, 0);
	}
	else {
		int i=0;
		while(numero!=0)
		{
			int temp=numero%10;
	   		Horno_grafico_digito(pos[i], y, temp);
	   		i++;
	   		numero=numero/10;

			}
		}

	}

void Horno_grafico_datos(uint32_t x, uint32_t y, uint32_t dato) {
	/* x igual para todos
	 * y=1, Pend max.
	 * y=2, Tiempo ascenso.
	 * y=3, Tiempo cocción.
	 * y=4, Temperatura Secado.
	 * y=5, Temperatura coccion.
	 */
	uint32_t numero=dato;

	if (numero >9999){
		Put_string_waddr(x,y,"ERR");
	}
	else if (numero ==0){
		Put_string_waddr(x,y,"0");
	}
	else{
		char str[4];
		itoa(numero,str,10);
		Put_string_waddr(x,y,str);
	}
}


